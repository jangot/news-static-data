<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>News Keywords</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <style>
        .days-container {
            width: 100%;
            display: flex;
            overflow: scroll;
        }
        .day-item {
            flex: 0 0 300px;
            border: 1px silver solid;
            margin: 5px;
            padding: 5px;
        }
    </style>
</head>
<body>
<h1>News Keywords</h1>
<div class="content">
    <div class="loading">Loading...</div>
    <div class="days-container">
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
<script>
    const MIN_COUNT = 20;
    const LIMIT_COUNT = 20;
    const BASE_URL = 'https://raw.githubusercontent.com/jangot/news-static-data/main/data/ria';
    function loadDay(day) {
        const dataForDayUrl = `${BASE_URL}/${day}.json`;
        console.log(dataForDayUrl);

        return fetch(dataForDayUrl)
            .then((response) => {
                if (!response.ok) {
                    throw new Error(`File [${day}] was not loaded: ${ response.statusText}`);
                }
                return response.json();
            })
            .catch((error) => {
                console.error(error);
                return null;
            })
    }
    function isLimit(keyword, index) {
        return keyword.count < MIN_COUNT || index > LIMIT_COUNT;
    }

    $(async() => {
        const searchParams = new URLSearchParams(window.location.search);
        const currentDate = searchParams.has('from') ? moment(searchParams.get('from')) : moment().startOf('day').add(-15, 'days');
        const lastDate = searchParams.has('to') ? moment(searchParams.get('to')) : moment().startOf('day');

        const container = $('.days-container');
        while (currentDate.isBefore(lastDate)) {
            const day = currentDate.format('YYYY-MM-DD');
            const dayList = await loadDay(day);
            if (dayList) {
                const html = dayList.keywords.map((keyword, index) => {
                    if (isLimit(keyword, index)) {
                        return '';
                    }
                    return ` <div>${keyword.keyword} : ${keyword.count}</div>`
                });
                container.append(`<div class="day-item"><h3>${day}</h3>${html.join('')}</div>`)
            }

            currentDate.add(1, 'days');
        }
        $('.loading').css('visibility', 'hidden')
    });
</script>
</body>
</html>
